<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Web3 Privacy Research Portal</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0b;
            color: #e4e4e7;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #1e1e26;
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid #27272a;
        }
        
        .success { color: #06d6a0; }
        .error { color: #ef4444; }
        .info { color: #8b5cf6; }
        
        button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 0.5rem;
        }
        
        button:hover { background: #7c3aed; }
        
        #test-results {
            margin-top: 1rem;
            padding: 1rem;
            background: #111115;
            border-radius: 0.5rem;
            border: 1px solid #27272a;
            font-family: monospace;
            white-space: pre-line;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="info">Web3 Privacy Research Portal - Test Suite</h1>
        <p>This page tests if all components are working correctly.</p>
        
        <button onclick="testDataAggregator()">Test Data Aggregation</button>
        <button onclick="testSearchEngine()">Test Search Engine</button>
        <button onclick="testFileAccess()">Test File Access</button>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearResults()">Clear Results</button>
        
        <div id="test-results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('test-results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
            resultsDiv.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            console.log(`[TEST] ${message}`);
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        async function testFileAccess() {
            log('Testing file access...');
            try {
                const response = await fetch('0xbow/constitutional_research.json');
                if (response.ok) {
                    const data = await response.json();
                    log(`Successfully loaded 0xbow project data. Project name: ${data.project_name}`, 'success');
                    log(`Description: ${data.description ? data.description.substring(0, 100) + '...' : 'N/A'}`);
                } else {
                    log(`Failed to load 0xbow data: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                log(`Error accessing file: ${error.message}`, 'error');
            }
        }
        
        async function testDataAggregator() {
            log('Testing Data Aggregator...');
            
            // Load the scripts if they haven't been loaded
            if (!window.DataAggregator) {
                await loadScript('data-aggregator.js');
            }
            
            if (window.dataAggregator) {
                log('DataAggregator instance found', 'success');
                try {
                    const projects = await window.dataAggregator.loadProjects();
                    log(`Successfully loaded ${projects.length} projects`, 'success');
                    
                    if (projects.length > 0) {
                        const firstProject = projects[0];
                        log(`First project: ${firstProject.name} (${firstProject.category})`);
                        
                        // Test search functionality
                        const searchResults = window.dataAggregator.searchProjects('privacy');
                        log(`Search for 'privacy' returned ${searchResults.length} results`);
                        
                        // Test filter options
                        const categories = window.dataAggregator.getCategories();
                        const blockchains = window.dataAggregator.getBlockchains();
                        const technologies = window.dataAggregator.getTechnologies();
                        
                        log(`Filter options: ${categories.length} categories, ${blockchains.length} blockchains, ${technologies.length} technologies`);
                    }
                } catch (error) {
                    log(`Error loading projects: ${error.message}`, 'error');
                }
            } else {
                log('DataAggregator not found', 'error');
            }
        }
        
        async function testSearchEngine() {
            log('Testing Search Engine...');
            
            if (!window.SearchEngine) {
                await loadScript('search.js');
            }
            
            if (window.searchEngine) {
                log('SearchEngine instance found', 'success');
                log('Search functionality would be tested in the full application context');
            } else {
                log('SearchEngine not found', 'error');
            }
        }
        
        async function runAllTests() {
            log('Running all tests...', 'info');
            clearResults();
            
            await testFileAccess();
            await testDataAggregator();
            await testSearchEngine();
            
            log('All tests completed!', 'success');
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Auto-run basic test on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('Test page loaded successfully', 'success');
            log('Click the buttons above to run specific tests');
        });
    </script>
</body>
</html>